version: "0.5"

processes:
  twid:
    command: go run ./cmd/twid -v -c ./twid.json
    depends_on:
      task:
        condition: process_completed_successfully
      funnel:
        condition: process_started
    readiness_probe:
      http_get:
        host: localhost
        port: 8080
        path: /health
      period_seconds: 1

  task:
    command: task

  funnel:
    command: tailscale funnel localhost:8080
